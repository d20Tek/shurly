@page "/short-url"
@attribute [Authorize]
@inject ShurlyApiService _service;

<h4 class="fw-bold">My Links</h4>
<div class="row">
    <a class="btn btn-outline-primary btn-sm" style="max-width: 180px;"
       href="/short-url/create">
       Create New Short Link
    </a>
</div>
<hr />

@if (_urlList is not null)
{
    @if (_urlList.Any())
    {
        <div class="row">
            <div class="col col-xl-8 offset-xl-2">
                @foreach (var shortLink in _urlList)
                {
                    <ShortUrlListItem Link=@shortLink />
                }
            </div>
        </div>
    }
    else
    {
        <div class="row">You don't have any saved short links. <a href="/short-url/create">Create one now!</a></div>
    }
}

<div>@message</div>
<hr />

@code {
    IEnumerable<ShortenedUrlResponse>? _urlList;
    string message = "Loading...";

    protected override async Task OnInitializedAsync()
    {
        var result = await _service.GetByOwnerAsync();
        result.MatchFirstError(
            success => {
                message = string.Empty;
                _urlList = success;
            },
            error => message = error.ToString());
    }
}
